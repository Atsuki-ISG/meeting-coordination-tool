# 操作手順書

## 社内メンバー向け

### 1. 初期セットアップ

#### 1.1 ログイン

1. アプリケーションURL にアクセス
2. 「Googleでログイン」ボタンをクリック
3. Googleアカウントを選択
4. カレンダーへのアクセスを許可

#### 1.2 承認を待つ / 招待コードで参加する

初回ログイン後、**承認待ち画面**が表示されます。

**招待コードをお持ちの場合（推奨）**:
- 「招待コードで参加する」ボタンをクリック
- チーム参加画面で招待コードを入力すると、承認を待たずに即時参加できます

**招待コードがない場合**:
- システム管理者があなたのアカウントを承認するまでお待ちください
- 画面は30秒ごとに自動でステータスを確認します
- 「ステータスを確認」ボタンで手動確認も可能です
- 承認されると自動的にチーム画面に移動します

#### 1.3 チームに参加する

承認後（または招待コード入力後）、チーム画面が表示されます。

**既存チームに参加する場合**:
1. 管理者から招待コードを受け取る
2. 「チームに参加」セクションに招待コードを入力
3. 「参加する」ボタンをクリック

**新しいチームを作成する場合**:
1. 「チームを作成」セクションでチーム名を入力
2. 「作成する」ボタンをクリック
3. 表示された招待コードを他のメンバーに共有

#### 1.4 複数チームへの参加・切り替え

複数のチームに所属することができます。

**チームを追加する**:
- サイドバー下部の「チームを切り替え」をクリック（または上部のチーム名をクリック）
- 「マイチーム」画面が表示される
- 「新しいチームを作成」または「招待コードで参加」から追加

**チームを切り替える**:
- 「マイチーム」画面でチーム一覧が表示される
- 切り替えたいチームの「切り替える」ボタンをクリック
- ダッシュボードに戻り、そのチームの予約タイプ・予約が表示される

---

### 2. ダッシュボード

ログイン後のメイン画面です。

**表示内容**:
- 今後の予約数
- 今月の予約数
- 有効な予約タイプ数
- 直近の予約一覧

**できること**:
- 予約タイプへのクイックアクセス
- 予約一覧へのアクセス

---

### 3. 予約タイプの管理

#### 3.1 予約タイプを作成する

1. ナビゲーションから「予約タイプ」をクリック
2. 「新規作成」ボタンをクリック
3. 以下の項目を入力:
   - **タイトル**: 予約の名前（例: 「初回相談」「定例ミーティング」）
   - **説明**: 予約の詳細説明（任意）
   - **所要時間**: 15分/30分/45分/60分 から選択
   - **参加モード**: 「全員必須」（全員が空いている時間のみ）または「誰か空いていれば」から選択
   - **参加メンバー**: この予約に参加するメンバーを選択
   - **メモ取り担当者を自動招待**: ONにすると、メモ取り担当に設定されたメンバーが参加メンバーに関わらずカレンダー招待に自動追加されます
   - **カレンダータイトル**: チームメンバーのGoogleカレンダーに表示されるイベントのタイトルをカスタマイズできます。変数（`{予約者名}`, `{メニュー名}`, `{日付}`, `{時刻}`, `{メール}`, `{備考}`）をクリックして挿入でき、プレビューで確認できます。ゲストには表示されません。
   - **予約可能時間帯の制限**: メンバーの可用性設定に加えて、この予約タイプ専用の時間帯制限を設定できます
     - **制限なし**: メンバーの可用性設定のみで判定
     - **テンプレートを使用**: チーム設定で作成した時間帯テンプレートを適用
     - **カスタム設定**: 曜日と時間帯を個別に指定
4. 「作成」ボタンをクリック

#### 3.2 予約リンクを共有する

1. 予約タイプ一覧で対象の予約タイプを見つける
2. 「リンクをコピー」ボタンをクリック
3. クリップボードにコピーされたURLを相手に共有

#### 3.3 予約タイプを編集する

1. 予約タイプ一覧で対象の「編集」ボタンをクリック
2. 必要な項目を修正
3. 「更新」ボタンをクリック

#### 3.4 予約タイプを削除する

1. 予約タイプ編集画面を開く
2. 「削除」ボタンをクリック
3. 確認ダイアログで「削除」を選択

---

### 4. 予約可能時間の設定

自分が予約を受け付ける曜日と時間を設定します。

1. ナビゲーションから「設定」をクリック
2. 曜日ごとに設定:
   - チェックボックスで有効/無効を切り替え
   - **「終日」トグル**: ONにすると時間帯の指定なしで終日オープンになります（Googleカレンダーの予定がある時間は自動的に除外されます）
   - 「終日」がOFFの場合: 開始時間と終了時間を選択
3. 「設定を保存」ボタンをクリック

**例**:
- 月〜金: 10:00〜17:00
- 月曜日のみ「終日」ON（終日空き、Googleカレンダーの予定のある時間を除く）
- 土日: 無効

---

### 5. 予約の確認

#### 5.1 予約一覧を見る

1. ナビゲーションから「予約一覧」をクリック
2. フィルターで表示を切り替え:
   - **今後の予約**: これから行われる予約
   - **過去の予約**: 終了した予約
   - **すべて**: 全件表示

#### 5.2 予約詳細の確認

予約一覧で各予約の以下を確認できます:
- 予約者名・メールアドレス
- 日時
- 予約タイプ名
- ステータス（確定/キャンセル）
- 備考

---

### 6. チーム設定

チームのメンバー情報を確認します。

1. ナビゲーションから「チーム設定」をクリック
2. メンバー一覧が表示される

**各メンバーで確認できる情報**:
- 名前・メールアドレス
- ロール（管理者/メンバー）バッジ
- カレンダー連携状態（連携済み / 未連携）
- メモ取り担当バッジ

**チーム管理者のみ操作可能**:
- チーム名の編集
- 招待コードの確認・コピー
- メンバーのロール変更（管理者/メンバー）
- メモ取り担当フラグの切り替え
- メンバーの削除
- チームの削除

#### 6.1 時間帯テンプレートの管理

予約タイプに適用できる時間帯制限のテンプレートを管理します（管理者のみ）。

1. チーム設定ページを開く
2. 「時間帯テンプレート」セクションで「+ 新規作成」をクリック
3. 以下の項目を入力:
   - **名前**: テンプレートの名前（例: 「平日午後のみ」）
   - **曜日**: 適用する曜日を選択（ボタンをクリック）
   - **時間帯**: 開始時間と終了時間を指定
4. 「作成」ボタンをクリック

作成したテンプレートは予約タイプの「予約可能時間帯の制限」で選択できます。

---

### 8. システム管理（システム管理者のみ）

システム管理者は以下の機能を利用できます。

1. ナビゲーションから「システム管理」をクリック
2. 以下の操作が可能:
   - 承認待ちユーザーの承認/拒否
   - 全ユーザーのステータス管理
   - システム管理者権限の付与/解除
   - API利用量の確認
   - メンテナンスモードの切り替え

---

## 外部ユーザー（予約者）向け

### 9. 予約の作成

#### 9.1 予約ページにアクセス

共有されたURLにアクセスします。

例: `https://example.com/book/abc123`

#### 9.2 ステップを確認する

予約ページには現在のステップが表示されます:

```
① 日時を選ぶ  →  ② 情報を入力  →  ③ 予約確定
```

#### 9.3 カレンダーから日付を選択

**カレンダー表示**:
- 月間カレンダー形式で空き状況を確認できます
- 各日付には以下の情報が表示されます:
  - **最早時間**: その日の最初の空き時間（例: 09:00）
  - **残り枠数**: その日の空き枠の数（例: 残り5件）
- 空きがない日は「ー」と表示されます
- 前月/次月への移動が可能です

**日付を選択**:
1. カレンダーで希望の日付をクリック
2. その日の空き時間一覧が表示されます
3. 希望の時間をクリック

#### 9.4 情報を入力

以下の項目を入力します:

| 項目 | 必須 | 説明 |
|------|------|------|
| お名前 | 必須 | 予約者の名前 |
| メールアドレス | 必須 | 連絡先メールアドレス |
| ご相談内容・備考 | 必須 | 相談したい内容や伝達事項 |

#### 9.5 予約を確定

1. 「予約を確定する」ボタンをクリック
2. 確定画面が表示されます

**確定画面で表示される情報**:
- 予約日時
- Google Meetリンク（オンライン会議用）
- キャンセルURL

**重要**: キャンセルURLは後で使用するため、控えておいてください。

---

### 10. 予約のキャンセル

予約をキャンセルする場合：

1. 予約確定時に表示されたキャンセルURLにアクセス
2. 予約内容を確認
3. 「予約をキャンセル」ボタンをクリック
4. キャンセル完了

**注意**:
- 過去の予約はキャンセルできません
- キャンセル後の再予約は、新規に予約を作成してください

---

## よくある質問

### Q: ログインしたら「承認待ち」と表示されました

**A**: 招待コードをお持ちの場合は「招待コードで参加する」ボタンをクリックしてコードを入力すると、承認を待たずに即時参加できます。招待コードがない場合は、システム管理者の承認をお待ちください。30秒ごとに自動でステータスが確認されます。

### Q: 予約可能な時間が表示されません

**A**: 以下を確認してください:
- 選択した日付が予約可能な曜日か
- 参加メンバー全員が予約可能時間を設定しているか
- 参加メンバーのカレンダーが連携されているか

### Q: カレンダーの日付に何も表示されません

**A**: その日は予約可能な空き枠がありません。別の日付を選択してください。カレンダーの日付に「ー」と表示されている場合は空き枠がありません。

### Q: Google Meetリンクが表示されません

**A**: 予約確定後にGoogle Meetリンクが自動生成されます。表示されない場合は、Googleカレンダーでイベントを直接確認してください。

### Q: 予約をキャンセルしたいがURLを忘れました

**A**: 社内メンバーに連絡し、予約一覧から該当予約を確認してもらってください。メンバー側からの対応が必要になる場合があります。

### Q: 予約日時を変更したい

**A**: 日時変更機能はありません。以下の手順で対応してください:
1. 現在の予約をキャンセル
2. 新しい日時で再度予約

### Q: 招待コードを忘れました

**A**: チームの作成者または既存メンバーに確認してください。チーム管理画面から招待コードを確認できます。

### Q: システム管理者になりたい

**A**: 既存のシステム管理者に依頼して、管理画面から権限を付与してもらってください。または、サーバー管理者が環境変数 `SYSTEM_ADMIN_EMAILS` にあなたのメールアドレスを追加することで、次回ログイン時に自動的にシステム管理者になります。
